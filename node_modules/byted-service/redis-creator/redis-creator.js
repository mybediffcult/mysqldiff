const IORedis = require('ioredis');
const Consul = require('../consul/consul');

class RedisCreator {
    constructor(options = {}) {
        this.consul = new Consul(options.consul);
    }

    /**
     * 创建Redis实例
     *
     * @param {Object} options - IORedis实例创建选项
     */
    async create(options) {
        if (options.psm) {
            const address = await this.consul.random(options.psm);
            options.host = address.host;
            options.port = address.port;
        }
        options = Object.assign({}, {
            enableReadyCheck: false,
            showFriendlyErrorStack: true,
        }, options);
        return new IORedis(options);
    }
}

module.exports = RedisCreator;