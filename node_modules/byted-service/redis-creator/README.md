# RedisCreator

`RedisCreator` 基于 [IORedis](https://github.com/luin/ioredis)，提供了根据PSM寻址的能力。

## 1. 创建RedisCreator实例
```javascript
const { RedisCreator } = require('byted-service');

const options = {
    consul: {
        host: '127.0.0.1',
        port: 2280
    }
};
const redisCreator = new RedisCreator(options);
```

`options`
- `consul`: Consul Agent配置，默认值为`{host: '127.0.0.1', port: 2280}`。

## 2. 创建IORedis实例
`RedisCreator` 提供了 `create` 方法用于创建 `IORedis` 实例，除了可通过 `psm` 选项指定 `redis` 数据库的地址外，其他参数选项和 `IORedis` 创建实例时所需的参数选项是一样的。

```javascript
// 根据PSM寻址
const redis = await redisCreator.create({
    psm: 'toutiao.redis.ies_fe_gecko_dev'
});

// 直接指定IP地址和端口
const redis = await redisCreator.create({
    host: '127.0.0.1',
    port: 6879
});
```

调用 `create` 方法创建 `IORedis` 实例时，默认将 `enableReadyCheck` 设置成了 `false`，因为在该选项为`true`的情况下，`IORedis` 在建立连接之后会调用 `info` 命令去检查 `redis` 数据库是否就绪，但是公司内部的 `redis` 数据库是通过代理转发指令的，代理并不支持 `info` 指令的转发，在执行 `info` 指令的时候会断开连接。所以如果 `enableReadyCheck` 为 `true`，则`IORedis`会一直尝试重连。此外，为了显示更加友好的错误栈，把 `showFriendlyErrorStack` 的值也默认设置为 `true` 了。

## 3. 操作Redis数据库
请参考`IORedis`使用文档：[https://github.com/luin/ioredis](https://github.com/luin/ioredis)。