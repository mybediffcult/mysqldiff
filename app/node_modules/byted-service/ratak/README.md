# Ratak
## 1. 创建Ratak实例
```js
const { Ratak } = require('byted-service');
const ratak = new Ratak(appid, secret);
```

## 2. API（所有API均返回Promise）

`queryDepartment(id)`：查询指定部门的信息
- id：String，指定的部门ID；

`querySubDepartments(id)`：查询指定部门的子部门
- id：String，指定的部门ID；

`signUrl(url, corpEnum)`：DingTalk - 使用JSAPI Ticket为指定的URL签名
- url：String，需要签名的URL；
- corpEnum：Number，分公司枚举，此为 ratak 系统内定义的枚举，如：0，1，2。

`sendDingTalkMessage(employeeKeys, agentId, type, content)`：DingTalk - 发送一条企业消息给指定员工；
- employeeKeys：Array[String]，指定的员工邮箱前缀列表；
- agentId：Number，指定发消息的微应用ID，值为：22750773；
- type：String，消息的类型：text，image，voice，file，link，OA, markdown；
- content：Object，消息体，请参考钉钉文档， https://open-doc.dingtalk.com/docs/doc.htm?spm=a219a.7629140.0.0.0WTkzI&treeId=172&articleId=104972&docType=1。

`sendDingTalkChannelMessage(channelId, type, content)`：DingTalk - 发送一条群会话消息
- channelId：Channel ID，请到『配置中心』获取；
- type：String，消息的类型：text，image，voice，file，link，OA, markdown；
- content：Object，消息体，请参考钉钉文档， https://open-doc.dingtalk.com/docs/doc.htm?spm=a219a.7629140.0.0.0WTkzI&treeId=172&articleId=104972&docType=1。

`addDingTalkChannelMembers(chatId, employeeKeys)`：DingTalk - 群会话增加成员
- channelId：String，Chat ID，请到『配置中心』获取；
- employeeKeys：Array[String]，员工邮箱前缀列表。

`sendEmail(recipients, subject, content)`：发送一条消息给指定员工的邮箱（该接口是异步的,即调用后立即返回）
- recipients：Array[String]，员工邮箱前缀列表；
- subject：String，邮件主题；
- content：String，邮件内容。

`queryEmployee(employeeKey)`：查询指定员工信息
- employeeKey：String，员工邮箱前缀。

`queryEmployeeGroups(employeeKey)`：查询员工的所在组
- employeeKey：String，员工邮箱前缀。

`queryEmployeeKeyByCode(code)`：OAuth - 通过 authorization code 获取免登的员工邮箱前缀
- code：String，Authorize API 返回的 authorization code。

`updatePermission(resourceKey, action, name, status)`：Permission - 修改权限信息
- resourceKey：String，资源标识；
- action：String，权限标识；
- name：String，权限名称；
- status：Boolean，权限是否启用。

`importPermissions(resourceKey, actions, groups = [], employees = [])`：Permission - 批量导入权限
- resourceKey：String，资源标识；
- actions：Array[String]，权限标识列表；
- groups：Array[Number]，分组标识列表；
- employees：Array[String]，员工邮箱前缀列表。

`queryEmployeePermissions(employeeKey, employeeType = 0)`：Permission - 查询指定员工拥有的所有权限
- employeeKey：String，员工邮箱前缀列表；
- employeeType：Number，0 或 1，默认为 0。如果指定为 0，则返回该员工所拥有的所有权限；如果指定为 1，则对实习生只返回临时权限，对全职员工返回所有权限。

`queryGroupsPermissions(groups = [])`：Permission - 查询指定组的所有权限
- groups：Array[Number]，分组标识列表。

`registerPermission(creatorKey, resourceKey, action, name)`：Permission - 注册权限
- creatorKey: String，创建者邮箱前缀；
- resourceKey：String，资源标识；
- action：String，权限标识；
- name：String，权限名称。

`queryEmployeePermissionsByResourceKeys(resourceKeys, employeeKey, employeeType = 0)`：Permission - 通过 resource keys 获取员工拥有的相应资源的权限
- resourceKeys：Array[String]，资源的Id列表；
- employeeKey：String，员工邮箱前缀；
- employeeType：Number，0 或 1，默认为 0。如果指定为 0，则返回该员工所拥有的所有权限；如果指定为 1，则对实习生只返回临时权限，对全职员工返回所有权限。

`updateResource(resourceKey, resource = {})`：Resource - 修改资源信息
- resourceKey：String，资源标识；
- resource：Object，资源信息；
- resource.name：String，资源名称；
- resource.url：String，资源地址；
- resource.adminUrl：String，资源的管理地址；
- resource.description：String，资源描述；
- resource.temporaryAuthorize：Boolean，资源是否允许临时授权；
- resource.status：Boolean，资源是否启用；
- resource.ownerKeys：Array[String]，资源admin权限拥有者的邮箱前缀列表。

`queryResourcePermissions(resourceKey)`：Resource - 查询拥有指定资源权限的员工和组（已废弃）
- resourceKey：String，资源标识。

`queryResourceEmployees(resourceKey)`：Resource - 查询拥有指定资源权限的员工
- resourceKey：String，资源标识。

`queryResource(resourceKey)`：Resource - 查询资源信息
- resourceKey：String，资源标识。

`registerResource(resource)`：Resource - 注册资源
- resource：Object，资源信息；
- resource.name：String，资源名称；
- resource.key：String，资源标识；
- resource.creatorKey：String，资源创建者邮箱前缀；
- resource.temporaryAuthorize：Boolean，资源是否允许临时授权；
- resource.ownerKeys：Array[String]，资源admin权限拥有者的邮箱前缀列表
- resource.url：String，资源地址；
- resource.adminUrl：String，资源的管理地址；
- resource.description：String，资源描述；
- resource.actions：Map，key为action, value为权限名。说明:如果没有指定该字段,则会默认创建 all 和 admin 权限。如果指定该字段,则会创建 actions 中的权限以及 admin 权限。 例如:{"read": "读权限"; "write": "写权限"}

`sendVoiceMessage(employeeKey, templateId, templateArgs, state, callbackUrl, times)`：voice - 第三方语音警报
- employeeKey：String，员工邮箱前缀；
- templateId：Number，文字模板 ID，1007 为 "项目 {project} 有报警，请查看钉钉"。在此处设置 http://bss.ucpaas.com/safetyCalls/admin/index；
- templateArgs：Object，文字模板参数。1007 示例：{"project": "lark"}；
- state：String，用户自定义内容(待生效)；
- callbackUrl：String，回调地址, 回调相关信息见 wiki https://wiki.bytedance.com/pages/viewpage.action?pageId=63236970；
- times：Number，失败重试次数, 最多为5, 目前一个号码一天最多被叫20次。